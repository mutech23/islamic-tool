<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Islamic Tools - Prayer Times & Qibla Finder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .compass {
      width: 200px; height: 200px; border-radius: 50%;
      position: relative; box-shadow: 0 0 15px rgba(0,0,0,0.2);
      background: conic-gradient(#f43f5e 0%, #f43f5e 90deg,
                                 #3b82f6 90deg, #3b82f6 180deg,
                                 #10b981 180deg, #10b981 270deg,
                                 #f59e0b 270deg, #f59e0b 360deg);
    }
    .compass-inner {
      width: 180px; height: 180px; border-radius: 50%;
      position: absolute; top: 10px; left: 10px; background-color: white;
      display: flex; justify-content: center; align-items: center;
    }
    .compass-needle {
      width: 4px; height: 80px; background-color: #ef4444;
      position: absolute; top: 10px; left: 98px;
      transform-origin: bottom center; transition: transform 0.5s ease;
      border-radius: 4px;
    }
    .compass-direction {
      position: absolute; font-weight: bold; color: #1f2937;
    }
    .north { top: 5px; left: 50%; transform: translateX(-50%); }
    .east { top: 50%; right: 5px; transform: translateY(-50%); }
    .south { bottom: 5px; left: 50%; transform: translateX(-50%); }
    .west { top: 50%; left: 5px; transform: translateY(-50%); }
  </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
  <div class="container mx-auto px-4 py-8">
    <header class="text-center mb-10">
      <h1 class="text-4xl font-bold text-indigo-800 mb-2">Islamic Tools</h1>
      <p class="text-gray-600 text-lg">Prayer Times & Qibla Finder</p>
      <div class="w-24 h-1 bg-indigo-500 mx-auto mt-4 rounded-full"></div>
    </header>

    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Prayer Times -->
      <div class="lg:w-2/3 bg-white p-6 rounded-xl shadow-md">
        <h2 class="text-2xl font-semibold mb-4 text-gray-800">Prayer Times</h2>
        <p id="location" class="text-gray-600 mb-4">Detecting your location...</p>
        <div id="prayer-times" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
      </div>

      <!-- Qibla Finder -->
      <div class="lg:w-1/3 bg-white p-6 rounded-xl shadow-md">
        <h2 class="text-2xl font-semibold text-gray-800 mb-6">Qibla Finder</h2>
        <div class="flex justify-center mb-8">
          <div class="compass">
            <div class="compass-inner">
              <div class="compass-needle" id="compass-needle"></div>
              <div class="compass-direction north">N</div>
              <div class="compass-direction east">E</div>
              <div class="compass-direction south">S</div>
              <div class="compass-direction west">W</div>
            </div>
          </div>
        </div>
        <p id="qibla-direction" class="text-center text-gray-700">Calculating Qibla...</p>
      </div>
    </div>

    <footer class="mt-12 text-center text-gray-600 py-6 border-t border-gray-200">
      <p>© 2025 Islamic Tools. All rights reserved.</p>
    </footer>
  </div>

  <audio id="adhan-audio" src="https://cdn.islamic.network/audio/adhan.mp3"></audio>

  <script>
    const prayerContainer = document.getElementById('prayer-times');
    const locationElement = document.getElementById('location');
    const adhanAudio = document.getElementById('adhan-audio');
    const compassNeedle = document.getElementById('compass-needle');
    const qiblaDirectionText = document.getElementById('qibla-direction');
    let userLocation = null, qiblaDirection = 0;

    // Get user location
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async position => {
        userLocation = {
          latitude: position.coords.latitude,
          longitude: position.coords.longitude
        };
        locationElement.textContent = `Lat: ${userLocation.latitude.toFixed(4)}, Long: ${userLocation.longitude.toFixed(4)}`;
        await getPrayerTimes();
        calculateQiblaDirection();
        setupCompass();
      }, error => {
        locationElement.textContent = "Location access denied. Cannot calculate prayer times or Qibla.";
      });
    }

    // Fetch prayer times from Aladhan API
    async function getPrayerTimes() {
      const today = new Date();
      const date = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
      const response = await fetch(`https://api.aladhan.com/v1/timings/${date}?latitude=${userLocation.latitude}&longitude=${userLocation.longitude}&method=2`);
      const data = await response.json();
      const times = data.data.timings;

      prayerContainer.innerHTML = '';
      Object.entries(times).forEach(([name, time]) => {
        if (["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"].includes(name)) {
          const div = document.createElement('div');
          div.className = "bg-indigo-50 p-4 rounded-lg text-center shadow hover:bg-indigo-100 transition";
          div.innerHTML = `<h3 class="text-lg font-semibold text-gray-800">${name}</h3>
                           <p class="text-2xl font-bold text-indigo-600">${time}</p>`;
          prayerContainer.appendChild(div);
        }
      });

      // Auto Adhan check every minute
      setInterval(() => checkAdhan(times), 60000);
    }

    // Play Adhan if prayer time matches current time
    function checkAdhan(times) {
      const now = new Date();
      const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
      for (const [name, time] of Object.entries(times)) {
        if (["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"].includes(name)) {
          if (currentTime === time.substring(0, 5)) {
            adhanAudio.play();
            alert(`It's time for ${name} prayer`);
          }
        }
      }
    }

    // Calculate Qibla direction
    function calculateQiblaDirection() {
      const kaaba = { lat: 21.4225, lng: 39.8262 };
      const lat1 = userLocation.latitude * Math.PI / 180;
      const lon1 = userLocation.longitude * Math.PI / 180;
      const lat2 = kaaba.lat * Math.PI / 180;
      const lon2 = kaaba.lng * Math.PI / 180;
      const y = Math.sin(lon2 - lon1) * Math.cos(lat2);
      const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2 - lon1);
      qiblaDirection = Math.atan2(y, x) * 180 / Math.PI;
      qiblaDirection = (qiblaDirection + 360) % 360;
      qiblaDirectionText.textContent = `Qibla direction: ${Math.round(qiblaDirection)}° from North`;
    }

    // Setup compass rotation
    function setupCompass() {
      if (window.DeviceOrientationEvent) {
        window.addEventListener('deviceorientation', e => {
          const heading = e.webkitCompassHeading || e.alpha;
          const angle = (360 - heading + qiblaDirection) % 360;
          compassNeedle.style.transform = `rotate(${angle}deg)`;
        });
      }
    }
  </script>
</body>
</html>
